<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trip Check-In Bot</title>

<style>
  :root {
    --bg: #0a0c10;
    --card: #0f1420;
    --text: #e6edf6;
    --border:#1f2a3a;
    --accent:#22d3ee;
    --accent2:#7c3aed;
  }

  body {
    margin:0;
    padding:40px;
    background:radial-gradient(1200px 900px at 10% -10%,#121a2b 0%,transparent 60%),var(--bg);
    color:var(--text);
    font-family:Inter,system-ui,sans-serif;
  }

  h1{font-size:32px;margin-bottom:25px;}

  .inputRow{display:flex;gap:10px;margin-bottom:25px;}

  input{
    padding:12px 15px;
    width:240px;
    border-radius:10px;
    border:1px solid var(--border);
    background:var(--card);
    color:var(--text);
  }

  button{
    padding:12px 16px;
    border:none;
    font-weight:600;
    border-radius:10px;
    cursor:pointer;
  }

  #loadBtn{background:#22d3ee;}
  #updateBtn{background:#7c3aed;color:#fff;}

  .taskItem{
    background:var(--card);
    border:1px solid var(--border);
    padding:12px;
    border-radius:10px;
    margin-top:10px;
    display:flex;
    justify-content:space-between;
  }

  .results{
    margin-top:20px;
    padding:20px;
    border-radius:10px;
    background:var(--card);
    border:1px solid var(--border);
    white-space:pre-wrap;
    font-family:Consolas,monospace;
  }
</style>
</head>

<body>
<h1>Trip Check-In Bot</h1>

<div class="inputRow">
  <input id="tripInput" placeholder="Enter Trip #">
  <button id="loadBtn">Load Trip</button>
  <button id="updateBtn">Update</button>
</div>

<div id="tasks"></div>
<div class="results" id="results"></div>

<script>
document.getElementById("loadBtn").onclick = async () => {
  const trip = document.getElementById("tripInput").value.trim();
  if (!trip) return alert("Enter a Trip #");

  const res = await fetch("/api/fms", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ action:"getTasks", trip })
  });

  const data = await res.json();
  renderTasks(data.tasks || []);
};

function renderTasks(tasks) {
  const c = document.getElementById("tasks");
  c.innerHTML = "";

  tasks.forEach(t => {
    const div = document.createElement("div");
    div.className = "taskItem";

    div.innerHTML = `
      <span>DO ${t.do} | PRO ${t.pro} | PU ${t.pu}</span>
      <input type="checkbox" ${t.complete ? "checked" : ""} 
        data-do="${t.do}"
        data-pro="${t.pro}"
        data-pu="${t.pu}"
        data-taskNo="${t.taskNo}"
        data-complete="${t.complete ? "1":"0"}"
      >
    `;

    c.appendChild(div);
  });
}

document.getElementById("updateBtn").onclick = async () => {
  const boxes = [...document.querySelectorAll("#tasks input[type='checkbox']")];

  const payload = boxes.map(b => ({
    taskNo: b.dataset.taskno,
    do: b.dataset.do,
    pro: b.dataset.pro,
    pu: b.dataset.pu,
    wasComplete: b.dataset.complete === "1",
    nowComplete: b.checked
  }));

  const res = await fetch("/api/fms", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ action:"update", tasks: payload })
  });

  const data = await res.json();
  document.getElementById("results").textContent = data.result;
};
</script>

</body>
</html>
